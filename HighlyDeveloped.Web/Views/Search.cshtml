@*
    ------------------------------------------------------------------------------
    FILE: /Views/Search.cshtml
    PURPOSE: 
        This Razor view renders a search page for Umbraco CMS, allowing users to 
        search for "newsArticle" content using Umbraco's InternalIndex. It displays 
        a hero section with an optional overlay color and image, a search form, 
        and the search results or a message if no results are found.
    MODEL:
        Umbraco.Web.PublishedModels.Search
    MAIN FEATURES:
        - Displays a hero image with an optional colored overlay.
        - Renders a search form that submits the query via GET.
        - Processes the search query from the request string.
        - Uses Umbraco's ContentQuery.Search to find "newsArticle" documents.
        - Shows the number of results found or a "no results" message.
        - Lists each result with a link to the content.
    PARAMETERS:
        heroImage (IPublishedContent): The image displayed in the hero section.
        heroOverlayColour (string): The hex color code for the hero overlay.
        searchQuery (string): The search term entered by the user.
        searchResults (IEnumerable<PublishedSearchResult>): The search results.
        resultsCount (int): The number of results found.
    USAGE:
        Place this view in the appropriate Views folder and ensure the model 
        and document types are configured in Umbraco. The search form submits 
        to the same page, displaying results dynamically.
    ------------------------------------------------------------------------------
*@
@inherits Umbraco.Web.Mvc.UmbracoViewPage<ContentModels.Search>
@using ContentModels = Umbraco.Web.PublishedModels;
@{
	Layout = "main.cshtml";
	
	var heroImage = Model.Value<IPublishedContent>("heroImage")?.Url ?? "";
	var heroOverlayColour = Model.Value<string>("heroOverlayColour");
	
	var searchQuery = Request.QueryString["query"];
	IEnumerable<PublishedSearchResult> searchResults;
	var resultsCount = 0;
	
	//Do we have a search?
	if(!string.IsNullOrEmpty(searchQuery)){
	    //Ask Umbraco to search for the term and give me the results
	    searchResults = Umbraco.ContentQuery.Search(searchQuery, string.Empty, "InternalIndex")
	                        .Where(w => w.Content.IsDocumentType("newsArticle"));
	    
	    resultsCount = searchResults != null && searchResults.Any() ? searchResults.Count() : 0;
	}
	else {
	    searchResults = null;
	}
	
}

@if(!string.IsNullOrEmpty(heroOverlayColour)){

    <style>
        .home-hero > .overlay {
            background-color: #@heroOverlayColour;
            opacity: 0.5;
        }
    </style>
}

<!-- Render the search box -->
<header class="jumbotron jumbotron-fluid home-hero" style="background-image:url('@heroImage')">
    <div class="overlay"></div>
    <div class="inner">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-10 mx-auto">
                    <h1>Search</h1>
                    <form action="@Model.Url" method="Get">
                        <fieldset>
                            <input type="text" class="search-box" placholder="Search..." name="query"></input>
                            <button class="search-button">Search</button>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
</header>
<section class="container">
    <h1>Search</h1>
    <!-- Search results to go here -->
    @if(!string.IsNullOrEmpty(searchQuery)){
        <div class="row">
            <div class="col">
                @if(resultsCount == 0 || searchResults == null){
                <text>
                    No results were found for @searchQuery
                </text>
                } else {
                    <text>
                        We found @resultsCount result(s).
                    </text>
                    <ul>
                        @foreach(var result in searchResults)
                        {
                            <li>
                                <h3>
                                    <a href="@result.Content.Url">@result.Content.Name</a>
                                </h3>
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    }
</section>
